<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - Bookmarks by Localforge</title>
  <link rel="icon" type="image/svg+xml" href="../../favicon.svg">
  <link rel="icon" type="image/png" href="../../favicon.png">
  <link rel="stylesheet" href="../shared/app.css">
</head>
<body class="layout">
  <header class="app-header">
    <nav class="app-header__nav">
      <a href="../library/library.html" class="app-header__nav-link">Library</a>
      <a href="../search/search.html" class="app-header__nav-link">Search</a>
      <a href="../stumble/stumble.html" class="app-header__nav-link">Stumble</a>
      <a href="options.html" class="app-header__nav-link active">Settings</a>
    </nav>
    <div class="app-header__brand">
      <div id="healthIndicator"></div>
      <h1 class="app-header__title">Bookmarks by Localforge</h1>
    </div>
  </header>

  <div class="main-content">
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <a href="#appearance" class="nav-item active" data-section="appearance">
          <span class="nav-label">Appearance</span>
        </a>
        <a href="#api-config" class="nav-item" data-section="api-config">
          <span class="nav-label">API Configuration</span>
        </a>
        <a href="#bulk-import" class="nav-item" data-section="bulk-import">
          <span class="nav-label">Bulk Import</span>
        </a>
        <a href="#import-export" class="nav-item" data-section="import-export">
          <span class="nav-label">Import / Export</span>
        </a>
        <a href="#webdav-sync" class="nav-item" data-section="webdav-sync">
          <span class="nav-label">WebDAV Sync</span>
        </a>
        <a href="#about" class="nav-item" data-section="about">
          <span class="nav-label">About</span>
        </a>
        <a href="#advanced-config" class="nav-item" data-section="advanced-config">
          <span class="nav-label">Advanced Config</span>
        </a>
      </nav>
    </aside>

    <main class="middle">
      <div class="settings-content">
        <div id="status" class="status hidden"></div>

        <section id="appearance" class="settings-section">
          <div class="option-panel">
            <div class="option-panel__header">
              <h2>Theme</h2>
              <p class="section-description">
                Choose your preferred appearance. Auto will follow your system preferences.
              </p>
            </div>
            <div class="option-panel__content">
              <div class="theme-options">
                <div class="theme-option">
                  <input type="radio" id="themeAuto" name="theme" value="auto" checked>
                  <label for="themeAuto">
                    <div class="theme-preview auto"></div>
                    <span class="theme-name">Auto</span>
                  </label>
                </div>
                <div class="theme-option">
                  <input type="radio" id="themeLight" name="theme" value="light">
                  <label for="themeLight">
                    <div class="theme-preview light">A</div>
                    <span class="theme-name">Light</span>
                  </label>
                </div>
                <div class="theme-option">
                  <input type="radio" id="themeDark" name="theme" value="dark">
                  <label for="themeDark">
                    <div class="theme-preview dark">A</div>
                    <span class="theme-name">Dark</span>
                  </label>
                </div>
                <div class="theme-option">
                  <input type="radio" id="themeTerminal" name="theme" value="terminal">
                  <label for="themeTerminal">
                    <div class="theme-preview terminal">&gt;_</div>
                    <span class="theme-name">Terminal</span>
                  </label>
                </div>
                <div class="theme-option">
                  <input type="radio" id="themeTufte" name="theme" value="tufte">
                  <label for="themeTufte">
                    <div class="theme-preview tufte">Aa</div>
                    <span class="theme-name">Tufte</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="api-config" class="settings-section">
          <div class="option-panel">
            <div class="option-panel__header">
              <h2>API Configuration</h2>
              <p class="section-description">
                Configure your OpenAI-compatible API connection for Q&A generation and semantic search.
              </p>
            </div>
            <form id="settingsForm" class="option-panel__content">
              <div class="form-group">
                <label for="apiBaseUrl">API Base URL</label>
                <input
                  type="url"
                  id="apiBaseUrl"
                  name="apiBaseUrl"
                  placeholder="https://api.openai.com/v1"
                  required
                />
                <small class="help-text">
                  OpenAI-compatible API endpoint. For OpenAI, use the default.
                  For local models, use your local endpoint (e.g., http://localhost:1234/v1)
                </small>
              </div>

              <div class="form-group">
                <label for="apiKey">API Key</label>
                <input
                  type="password"
                  id="apiKey"
                  name="apiKey"
                  placeholder="sk-..."
                  required
                />
                <small class="help-text">
                  Your OpenAI API key or compatible provider key
                </small>
              </div>

              <div class="form-group">
                <label for="chatModel">Chat Model</label>
                <input
                  type="text"
                  id="chatModel"
                  name="chatModel"
                  placeholder="gpt-4o-mini"
                  required
                />
                <small class="help-text">
                  Model for Q&A generation (e.g., gpt-4o-mini, gpt-4o)
                </small>
              </div>

              <div class="form-group">
                <label for="embeddingModel">Embedding Model</label>
                <input
                  type="text"
                  id="embeddingModel"
                  name="embeddingModel"
                  placeholder="text-embedding-3-small"
                  required
                />
                <small class="help-text">
                  Model for generating embeddings (e.g., text-embedding-3-small)
                </small>
              </div>

              <div class="button-group">
                <button type="submit" class="btn btn-primary">
                  Save Settings
                </button>
                <button type="button" id="testBtn" class="btn btn-secondary">
                  Test Connection
                </button>
              </div>
            </form>
          </div>
        </section>

        <section id="bulk-import" class="settings-section">
          <div class="option-panel">
            <div class="option-panel__header">
              <h2>Bulk Import URLs</h2>
              <p class="section-description">
                Import multiple bookmarks at once by pasting a list of URLs (one per line).
              </p>
            </div>
            <div class="option-panel__content">
              <div class="bulk-import-container">
                <textarea
                  id="bulkUrlsInput"
                  rows="10"
                  placeholder="https://example.com/article1&#10;https://example.com/article2&#10;https://github.com/user/repo"
                ></textarea>

                <div id="urlValidationFeedback" class="validation-feedback"></div>

                <div class="button-group">
                  <button type="button" id="startBulkImport" class="btn btn-primary" disabled>
                    Import URLs
                  </button>
                  <button type="button" id="cancelBulkImport" class="btn btn-secondary hidden">
                    Cancel
                  </button>
                </div>

                <div id="bulkImportProgress" class="bulk-import-progress hidden">
                  <div class="progress-bar-container">
                    <div id="bulkImportProgressBar" class="progress-bar"></div>
                  </div>
                  <span id="bulkImportStatus" class="progress-status">Processing...</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="import-export" class="settings-section">
          <div class="option-panel">
            <div class="option-panel__header">
              <h2>Import / Export</h2>
              <p class="section-description">
                Backup your bookmarks or transfer them between browsers.
              </p>
            </div>
            <div class="option-panel__content">
              <div class="data-actions">
                <div class="data-action">
                  <h3>Export Bookmarks</h3>
                  <p>Download all your bookmarks as a JSON file.</p>
                  <button type="button" id="exportBtn" class="btn btn-secondary">
                    Export All Bookmarks
                  </button>
                </div>

                <div class="data-action">
                  <h3>Import Bookmarks</h3>
                  <p>Import bookmarks from a previously exported JSON file. Duplicates will be skipped.</p>
                  <input type="file" id="importFile" accept=".json" class="file-input" />
                  <label for="importFile" class="btn btn-secondary file-label">
                    Choose File to Import
                  </label>
                  <span id="importFileName" class="file-name"></span>
                  <button type="button" id="importBtn" class="btn btn-primary" disabled>
                    Import
                  </button>
                </div>
              </div>

              <div id="importStatus" class="import-status hidden"></div>
            </div>
          </div>
        </section>

        <section id="webdav-sync" class="settings-section">
          <div class="option-panel">
            <div class="option-panel__header">
              <h2>WebDAV Sync</h2>
              <p class="section-description">
                Sync your bookmarks across devices using a WebDAV server (Nextcloud, ownCloud, Synology, etc.)
              </p>
            </div>
            <form id="webdavForm" class="option-panel__content">
              <div class="form-group">
                <label class="toggle-label">
                  <input type="checkbox" id="webdavEnabled" name="webdavEnabled" />
                  <span class="toggle-text">Enable WebDAV Sync</span>
                </label>
                <small class="help-text">
                  When enabled, bookmarks will sync automatically with your WebDAV server
                </small>
              </div>

              <div id="webdavFields" class="conditional-fields">
                <div class="form-group">
                  <label for="webdavUrl">Server URL</label>
                  <input
                    type="url"
                    id="webdavUrl"
                    name="webdavUrl"
                    placeholder="https://cloud.example.com/remote.php/dav/files/username"
                  />
                  <small class="help-text">
                    Full WebDAV endpoint URL. For Nextcloud: <code>https://your-server/remote.php/dav/files/USERNAME</code>
                  </small>
                  <div id="webdavUrlWarning" class="security-warning hidden">
                    <strong>Security Warning:</strong> HTTP connections send credentials in plain text.
                    Please use HTTPS, or enable "Allow insecure connections" below if you understand the risks.
                  </div>
                </div>

                <div class="form-group">
                  <label for="webdavUsername">Username</label>
                  <input
                    type="text"
                    id="webdavUsername"
                    name="webdavUsername"
                    placeholder="your-username"
                    autocomplete="username"
                  />
                  <small class="help-text">
                    Your WebDAV server username
                  </small>
                </div>

                <div class="form-group">
                  <label for="webdavPassword">Password</label>
                  <input
                    type="password"
                    id="webdavPassword"
                    name="webdavPassword"
                    placeholder="••••••••"
                    autocomplete="current-password"
                  />
                  <small class="help-text">
                    Your WebDAV server password or app-specific password. Stored locally only.
                  </small>
                </div>

                <div class="form-group">
                  <label for="webdavPath">Sync Folder Path</label>
                  <input
                    type="text"
                    id="webdavPath"
                    name="webdavPath"
                    placeholder="/bookmarks"
                  />
                  <small class="help-text">
                    Folder path on the server where bookmark data will be stored (will be created if it doesn't exist)
                  </small>
                </div>

                <div class="form-group">
                  <label for="webdavSyncInterval">Auto-sync Interval (minutes)</label>
                  <input
                    type="number"
                    id="webdavSyncInterval"
                    name="webdavSyncInterval"
                    min="0"
                    max="1440"
                    placeholder="15"
                  />
                  <small class="help-text">
                    How often to automatically sync (0 to disable auto-sync)
                  </small>
                </div>

                <div class="form-group">
                  <label class="toggle-label">
                    <input type="checkbox" id="webdavAllowInsecure" name="webdavAllowInsecure" />
                    <span class="toggle-text">Allow insecure connections (HTTP)</span>
                  </label>
                  <small class="help-text security-help">
                    Only enable this for development or testing. HTTP connections send your credentials in plain text, which is a security risk.
                  </small>
                </div>

                <div id="webdavConnectionStatus" class="connection-status hidden">
                  <span class="status-indicator"></span>
                  <span class="status-text"></span>
                </div>

                <div class="button-group">
                  <button type="submit" class="btn btn-primary">
                    Save Settings
                  </button>
                  <button type="button" id="testWebdavBtn" class="btn btn-secondary">
                    Test Connection
                  </button>
                </div>

                <div id="syncStatusSection" class="sync-status-section">
                  <h4>Sync Status</h4>
                  <div id="syncStatusIndicator" class="sync-status-indicator">
                    <span class="sync-status-icon"></span>
                    <span class="sync-status-text">Not synced yet</span>
                  </div>
                  <button type="button" id="syncNowBtn" class="btn btn-secondary">
                    Sync Now
                  </button>
                </div>
              </div>
            </form>
          </div>
        </section>

        <section id="about" class="settings-section">
          <div class="option-panel">
            <div class="option-panel__header">
              <h2>About</h2>
            </div>
            <div class="option-panel__content">
              <p>
                Bookmarks by Localforge captures web pages and uses AI to generate searchable
                question-answer pairs, enabling semantic search across your bookmarks.
              </p>
              <p>
                <strong>Privacy:</strong> All bookmarks are stored locally in your browser.
                Only the extracted content is sent to your configured API for processing.
              </p>
            </div>
          </div>

          <div class="option-panel">
            <div class="option-panel__header">
              <h2>Links</h2>
            </div>
            <div class="option-panel__content">
              <ul class="about-links">
                <li><a href="https://github.com/longregen/bookmarks" target="_blank" rel="noopener">Source Code on GitHub</a></li>
                <li><a href="https://longregen.github.io/bookmarks/" target="_blank" rel="noopener">Web App (GitHub Pages)</a></li>
                <li><a href="https://github.com/longregen/bookmarks/issues" target="_blank" rel="noopener">Report Issues</a></li>
                <li><a href="https://github.com/longregen/bookmarks/releases" target="_blank" rel="noopener">Releases</a></li>
              </ul>
            </div>
          </div>

          <div class="option-panel">
            <div class="option-panel__header">
              <h2>Dependencies</h2>
              <p class="section-description">Runtime libraries used by this extension.</p>
            </div>
            <div class="option-panel__content">
              <ul class="about-deps">
                <li><a href="https://github.com/nickvdyck/dexie" target="_blank" rel="noopener"><strong>Dexie</strong></a> – IndexedDB wrapper for local bookmark storage</li>
                <li><a href="https://github.com/mozilla/readability" target="_blank" rel="noopener"><strong>@mozilla/readability</strong></a> – Extracts readable content from web pages</li>
                <li><a href="https://github.com/markedjs/marked" target="_blank" rel="noopener"><strong>Marked</strong></a> – Markdown parser for rendering content</li>
                <li><a href="https://github.com/mixmark-io/turndown" target="_blank" rel="noopener"><strong>Turndown</strong></a> – Converts HTML to Markdown</li>
              </ul>
            </div>
          </div>

          <div class="option-panel">
            <div class="option-panel__header">
              <h2>Development Tools</h2>
              <p class="section-description">Tools and frameworks used to build this extension.</p>
            </div>
            <div class="option-panel__content">
              <ul class="about-deps">
                <li><a href="https://vitejs.dev/" target="_blank" rel="noopener"><strong>Vite</strong></a> – Build tool and dev server</li>
                <li><a href="https://www.typescriptlang.org/" target="_blank" rel="noopener"><strong>TypeScript</strong></a> – Typed JavaScript</li>
                <li><a href="https://vitest.dev/" target="_blank" rel="noopener"><strong>Vitest</strong></a> – Unit testing framework</li>
                <li><a href="https://crxjs.dev/vite-plugin" target="_blank" rel="noopener"><strong>CRXJS Vite Plugin</strong></a> – Chrome extension development with Vite</li>
                <li><a href="https://pptr.dev/" target="_blank" rel="noopener"><strong>Puppeteer</strong></a> – Browser automation for E2E testing</li>
                <li><a href="https://www.selenium.dev/" target="_blank" rel="noopener"><strong>Selenium WebDriver</strong></a> – Firefox E2E testing</li>
              </ul>
            </div>
          </div>

          <div class="option-panel">
            <div class="option-panel__header">
              <h2>CI/CD & Automation</h2>
              <p class="section-description">GitHub Actions workflows that power the project.</p>
            </div>
            <div class="option-panel__content">
              <ul class="about-deps">
                <li><strong>Test Extension</strong> – Runs unit tests and E2E tests on Chrome, Firefox, and Web</li>
                <li><strong>Deploy to GitHub Pages</strong> – Publishes the web app to GitHub Pages</li>
                <li><strong>Create Draft Release</strong> – Automatically creates releases with packaged extensions</li>
                <li><strong>Publish to Browser Stores</strong> – Publishes to Chrome Web Store and Firefox Add-ons</li>
                <li><strong>Bump Version</strong> – Automates version bumping across all manifest files</li>
                <li><strong>Update Screenshots</strong> – Captures and updates landing page screenshots</li>
              </ul>
            </div>
          </div>

          <div class="option-panel">
            <div class="option-panel__header">
              <h2>GitHub Actions Providers</h2>
              <p class="section-description">Third-party actions used in the CI/CD workflows.</p>
            </div>
            <div class="option-panel__content">
              <ul class="about-deps">
                <li><a href="https://github.com/actions/checkout" target="_blank" rel="noopener"><strong>actions/checkout</strong></a> – Checks out the repository</li>
                <li><a href="https://github.com/actions/setup-node" target="_blank" rel="noopener"><strong>actions/setup-node</strong></a> – Sets up Node.js environment</li>
                <li><a href="https://github.com/actions/cache" target="_blank" rel="noopener"><strong>actions/cache</strong></a> – Caches dependencies for faster builds</li>
                <li><a href="https://github.com/actions/upload-artifact" target="_blank" rel="noopener"><strong>actions/upload-artifact</strong></a> – Uploads build artifacts</li>
                <li><a href="https://github.com/actions/download-artifact" target="_blank" rel="noopener"><strong>actions/download-artifact</strong></a> – Downloads build artifacts</li>
                <li><a href="https://github.com/actions/configure-pages" target="_blank" rel="noopener"><strong>actions/configure-pages</strong></a> – Configures GitHub Pages</li>
                <li><a href="https://github.com/actions/upload-pages-artifact" target="_blank" rel="noopener"><strong>actions/upload-pages-artifact</strong></a> – Uploads Pages deployment artifact</li>
                <li><a href="https://github.com/actions/deploy-pages" target="_blank" rel="noopener"><strong>actions/deploy-pages</strong></a> – Deploys to GitHub Pages</li>
                <li><a href="https://github.com/browser-actions/setup-firefox" target="_blank" rel="noopener"><strong>browser-actions/setup-firefox</strong></a> – Installs Firefox for E2E testing</li>
                <li><a href="https://github.com/softprops/action-gh-release" target="_blank" rel="noopener"><strong>softprops/action-gh-release</strong></a> – Creates GitHub releases</li>
                <li><a href="https://github.com/robinraju/release-downloader" target="_blank" rel="noopener"><strong>robinraju/release-downloader</strong></a> – Downloads release assets</li>
                <li><a href="https://github.com/mnao305/chrome-extension-upload" target="_blank" rel="noopener"><strong>mnao305/chrome-extension-upload</strong></a> – Publishes to Chrome Web Store</li>
                <li><a href="https://github.com/kewisch/action-web-ext" target="_blank" rel="noopener"><strong>kewisch/action-web-ext</strong></a> – Signs and publishes Firefox Add-ons</li>
              </ul>
            </div>
          </div>

          <div class="option-panel">
            <div class="option-panel__header">
              <h2>License</h2>
            </div>
            <div class="option-panel__content">
              <p>
                This project is open source and available under the <strong>MIT License</strong>.
                See the <a href="https://github.com/longregen/bookmarks/blob/main/LICENSE.md" target="_blank" rel="noopener">LICENSE.md file</a> for details.
              </p>
            </div>
          </div>
        </section>

        <section id="advanced-config" class="settings-section">
          <div class="option-panel">
            <div class="option-panel__header">
              <h2>Advanced Configuration</h2>
              <p class="section-description">
                Modify internal settings similar to Firefox's about:config.
                <strong>Warning:</strong> Changing these values may affect application behavior.
                Only modify if you understand what you're doing.
              </p>
            </div>
            <div class="option-panel__content">
              <div id="configStatus" class="config-status hidden"></div>

              <div class="config-controls">
                <div class="config-search">
                  <input
                    type="text"
                    id="configSearch"
                    placeholder="Search configuration..."
                    class="config-search-input"
                  />
                </div>
                <div class="config-filters">
                  <select id="configCategoryFilter" class="filter-select">
                  </select>
                  <label class="config-checkbox-label">
                    <input type="checkbox" id="showModifiedOnly" />
                    <span>Show modified only</span>
                  </label>
                </div>
                <div class="config-actions-header">
                  <span class="modified-count-wrapper hidden">
                    <span id="modifiedConfigCount">0</span> modified
                  </span>
                  <button type="button" id="resetAllConfig" class="btn btn-secondary btn-sm" disabled>
                    Reset All
                  </button>
                </div>
              </div>

              <div class="config-table-wrapper">
                <table class="config-table">
                  <thead>
                    <tr>
                      <th class="config-th-key">Setting</th>
                      <th class="config-th-type">Type</th>
                      <th class="config-th-value">Value</th>
                      <th class="config-th-default">Default</th>
                      <th class="config-th-actions"></th>
                    </tr>
                  </thead>
                  <tbody id="configTableBody">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script src="options.ts" type="module"></script>
</body>
</html>
