<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - Bookmarks by Localforge</title>
  <link rel="stylesheet" href="../shared/theme.css">
  <style>
    body { margin: 0; font-family: var(--font-family); background: var(--bg-primary); color: var(--text-primary); }
    .layout { display: flex; flex-direction: column; height: 100vh; }
    .main-content { display: flex; flex: 1; overflow: hidden; }
    .sidebar { width: 240px; background: var(--bg-secondary); border-right: 1px solid var(--border-primary); padding: var(--space-6) 0; overflow-y: auto; }
    .sidebar-nav { display: flex; flex-direction: column; gap: var(--space-1); padding: 0 var(--space-3); }
    .nav-item { display: flex; align-items: center; gap: var(--space-3); padding: var(--space-3) var(--space-4); border-radius: var(--radius-lg); text-decoration: none; color: var(--text-secondary); font-size: var(--text-base); font-weight: var(--font-medium); transition: all var(--transition-base); }
    .nav-item:hover { background: var(--bg-hover); color: var(--text-primary); }
    .nav-item.active { background: var(--accent-primary); color: var(--accent-text); }
    .nav-icon { font-size: 18px; width: var(--space-6); text-align: center; }
    .nav-label { flex: 1; }
    .middle { flex: 1; overflow-y: auto; padding: var(--space-6); }
    .settings-content { max-width: 900px; margin: 0 auto; }
    .settings-section { margin-bottom: var(--space-7); scroll-margin-top: var(--space-6); }
    .status { padding: var(--space-4); border-radius: var(--radius-lg); margin-bottom: var(--space-6); font-size: var(--text-base); font-weight: var(--font-medium); }
    .status.hidden { display: none; }
    .status.success { background: var(--success-bg); color: var(--success-text); border: 1px solid var(--success-border); }
    .status.error { background: var(--error-bg); color: var(--error-text); border: 1px solid var(--error-border); }
    form, .data-section, .theme-section, .info-section { background: var(--bg-secondary); border: 1px solid var(--border-primary); border-radius: var(--radius-xl); padding: var(--space-6); }
    @media (min-width: 768px) { form, .data-section, .theme-section, .info-section { padding: var(--space-7); } }
    h2 { font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--text-primary); margin-bottom: var(--space-3); }
    h3 { font-size: var(--text-md); font-weight: var(--font-semibold); color: var(--text-primary); margin-bottom: var(--space-2); }
    .section-description { color: var(--text-tertiary); font-size: var(--text-base); margin-bottom: var(--space-6); line-height: var(--leading-relaxed); }
    .form-group { margin-bottom: var(--space-6); }
    .form-group:last-of-type { margin-bottom: var(--space-7); }
    label { display: block; font-size: var(--text-base); font-weight: var(--font-medium); color: var(--text-secondary); margin-bottom: var(--space-2); }
    input[type="text"], input[type="url"], input[type="password"] { width: 100%; padding: var(--space-3) var(--space-4); border: 1px solid var(--border-secondary); border-radius: var(--radius-lg); font-size: var(--text-base); font-family: inherit; transition: all var(--transition-base); background: var(--bg-input); color: var(--text-primary); }
    input:focus { outline: none; border-color: var(--border-focus); box-shadow: var(--shadow-focus); }
    .help-text { display: block; margin-top: var(--space-2); font-size: var(--text-sm); color: var(--text-tertiary); line-height: var(--leading-normal); }
    .button-group { display: flex; gap: var(--space-3); }
    .theme-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: var(--space-4); margin-top: var(--space-4); }
    .theme-option { position: relative; }
    .theme-option input[type="radio"] { position: absolute; opacity: 0; width: 0; height: 0; }
    .theme-option label { display: flex; flex-direction: column; align-items: center; padding: var(--space-5) var(--space-4); border: 2px solid var(--border-primary); border-radius: var(--radius-lg); cursor: pointer; transition: all var(--transition-base); background: var(--bg-tertiary); }
    .theme-option label:hover { border-color: var(--border-secondary); }
    .theme-option input[type="radio"]:checked + label { border-color: var(--accent-primary); background: var(--bg-hover); }
    .theme-option input[type="radio"]:focus-visible + label { box-shadow: var(--shadow-focus); }
    .theme-preview { width: 64px; height: 48px; border-radius: var(--radius-sm); margin-bottom: var(--space-3); display: flex; align-items: center; justify-content: center; font-size: var(--text-lg); font-weight: var(--font-bold); }
    .theme-preview.auto { background: linear-gradient(135deg, #f9fafb 50%, #1f2937 50%); border: 1px solid var(--border-secondary); }
    .theme-preview.light { background: #f9fafb; border: 1px solid #e5e7eb; color: #111827; }
    .theme-preview.dark { background: #1f2937; border: 1px solid #374151; color: #f9fafb; }
    .theme-preview.terminal { background: #000000; border: 1px solid #333333; color: #00ff00; font-family: var(--font-mono); }
    .theme-preview.tufte { background: #fffff8; border: 1px solid #e0ddd4; color: #a00000; font-family: Georgia, serif; font-style: italic; }
    .theme-name { font-size: var(--text-base); font-weight: var(--font-medium); color: var(--text-primary); margin-bottom: 0; }
    .data-actions { display: grid; gap: var(--space-6); }
    @media (min-width: 768px) { .data-actions { grid-template-columns: repeat(2, 1fr); } }
    .data-action { padding: var(--space-5); background: var(--bg-tertiary); border-radius: var(--radius-lg); }
    .data-action h3 { font-size: var(--text-md); font-weight: var(--font-semibold); color: var(--text-primary); margin-bottom: var(--space-2); }
    .data-action p { font-size: var(--text-base); color: var(--text-tertiary); margin-bottom: var(--space-4); }
    .file-input { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
    .file-label { display: inline-block; margin-right: var(--space-3); }
    .file-name { font-size: var(--text-base); color: var(--text-tertiary); margin-right: var(--space-3); }
    .import-status { margin-top: var(--space-6); }
    .import-status.hidden { display: none; }
    .import-result { padding: var(--space-4); border-radius: var(--radius-lg); font-size: var(--text-base); }
    .import-result.success { background: var(--success-bg); color: var(--success-text); border: 1px solid var(--success-border); }
    .import-result.warning { background: var(--warning-bg); color: var(--warning-text); border: 1px solid var(--warning-border); }
    .import-result.error { background: var(--error-bg); color: var(--error-text); border: 1px solid var(--error-border); }
    .import-errors { margin-top: var(--space-3); padding-left: var(--space-5); font-size: var(--text-sm); }
    .import-errors li { margin-bottom: var(--space-1); }
    .info-section p { margin-bottom: var(--space-3); color: var(--text-secondary); line-height: var(--leading-relaxed); }
    .info-section p:last-child { margin-bottom: 0; }
    .bulk-import-container { display: flex; flex-direction: column; gap: var(--space-4); }
    #bulkUrlsInput { width: 100%; padding: var(--space-3) var(--space-4); border: 1px solid var(--border-secondary); border-radius: var(--radius-lg); font-size: var(--text-base); font-family: var(--font-mono); resize: vertical; min-height: 200px; background: var(--bg-input); color: var(--text-primary); line-height: var(--leading-relaxed); }
    #bulkUrlsInput:focus { outline: none; border-color: var(--border-focus); box-shadow: var(--shadow-focus); }
    .validation-feedback { padding: var(--space-3); border-radius: var(--radius-lg); font-size: var(--text-base); display: none; }
    .validation-feedback.show { display: block; }
    .validation-feedback.valid { background: var(--success-bg); color: var(--success-text); border: 1px solid var(--success-border); }
    .validation-feedback.invalid { background: var(--error-bg); color: var(--error-text); border: 1px solid var(--error-border); }
    .validation-feedback.warning { background: var(--warning-bg); color: var(--warning-text); border: 1px solid var(--warning-border); }
    .bulk-import-progress { padding: var(--space-4); background: var(--bg-tertiary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary); }
    .bulk-import-progress.hidden { display: none; }
    .progress-bar-container { width: 100%; height: var(--space-6); background: var(--progress-bg); border-radius: var(--radius-xl); overflow: hidden; margin-bottom: var(--space-3); }
    .progress-bar { height: 100%; background: var(--progress-fill); transition: width var(--transition-slow); width: 0%; display: flex; align-items: center; justify-content: center; color: white; font-size: var(--text-sm); font-weight: var(--font-semibold); }
    .progress-status { display: block; text-align: center; font-size: var(--text-base); color: var(--text-tertiary); }
    .jobs-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-6); gap: var(--space-4); flex-wrap: wrap; }
    .jobs-filters { display: flex; gap: var(--space-3); flex-wrap: wrap; }
    .filter-select { padding: var(--space-2) var(--space-3); border: 1px solid var(--border-secondary); border-radius: var(--radius-md); font-size: var(--text-base); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; transition: all var(--transition-base); }
    .filter-select:hover { border-color: var(--border-secondary); }
    .filter-select:focus { outline: none; border-color: var(--border-focus); box-shadow: var(--shadow-focus); }
    .jobs-list { max-height: none; overflow-y: visible; border: 1px solid var(--border-primary); border-radius: var(--radius-lg); }
    .jobs-list .loading, .jobs-list .empty { padding: var(--space-8); text-align: center; color: var(--text-tertiary); }
    .job-item { padding: var(--space-4); border-bottom: 1px solid var(--border-primary); cursor: pointer; transition: background var(--transition-base); }
    .job-item:hover { background: var(--bg-hover); }
    .job-item:last-child { border-bottom: none; }
    .job-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-2); }
    .job-info { flex: 1; }
    .job-type { font-weight: var(--font-semibold); font-size: var(--text-base); color: var(--text-primary); margin-bottom: var(--space-1); }
    .job-timestamp { font-size: var(--text-sm); color: var(--text-tertiary); }
    .job-status-badge { display: inline-flex; align-items: center; padding: var(--space-1) var(--space-3); border-radius: var(--radius-md); font-size: var(--text-xs); font-weight: var(--font-semibold); text-transform: uppercase; letter-spacing: 0.3px; }
    .job-status-badge.pending { background: var(--warning-bg); color: var(--warning-text); }
    .job-status-badge.in_progress { background: var(--info-bg); color: var(--info-text); }
    .job-status-badge.completed { background: var(--success-bg); color: var(--success-text); }
    .job-status-badge.failed { background: var(--error-bg); color: var(--error-text); }
    .job-status-badge.cancelled { background: var(--bg-tertiary); color: var(--text-tertiary); }
    .job-progress { display: flex; align-items: center; gap: var(--space-3); margin-top: var(--space-2); }
    .job-progress-bar { flex: 1; height: 6px; background: var(--progress-bg); border-radius: var(--radius-sm); overflow: hidden; }
    .job-progress-fill { height: 100%; background: var(--accent-primary); transition: width var(--transition-slow); }
    .job-progress-text { font-size: var(--text-sm); color: var(--text-tertiary); min-width: var(--space-8); text-align: right; }
    .job-metadata { margin-top: var(--space-3); padding: var(--space-3); background: var(--bg-tertiary); border-radius: var(--radius-md); font-size: var(--text-sm); color: var(--text-tertiary); display: none; }
    .job-item.expanded .job-metadata { display: block; }
    .job-metadata-item { margin-bottom: var(--space-1); }
    .job-metadata-item:last-child { margin-bottom: 0; }
    .job-metadata-item strong { color: var(--text-secondary); }
    .job-error { margin-top: var(--space-2); padding: var(--space-3); background: var(--error-bg); border: 1px solid var(--error-border); border-radius: var(--radius-md); font-size: var(--text-sm); color: var(--error-text); }
  </style>
</head>
<body class="layout">
  <header class="app-header">
    <nav class="app-header__nav">
      <a href="../library/library.html" class="app-header__nav-link">Library</a>
      <a href="../search/search.html" class="app-header__nav-link">Search</a>
      <a href="../stumble/stumble.html" class="app-header__nav-link">Stumble</a>
      <a href="options.html" class="app-header__nav-link active">Settings</a>
    </nav>
    <div class="app-header__brand">
      <div id="healthIndicator"></div>
      <h1 class="app-header__title">Bookmarks by Localforge</h1>
    </div>
  </header>

  <div class="main-content">
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <a href="#appearance" class="nav-item active" data-section="appearance">
          <span class="nav-label">Appearance</span>
        </a>
        <a href="#api-config" class="nav-item" data-section="api-config">
          <span class="nav-label">API Configuration</span>
        </a>
        <a href="#bulk-import" class="nav-item" data-section="bulk-import">
          <span class="nav-label">Bulk Import</span>
        </a>
        <a href="#import-export" class="nav-item" data-section="import-export">
          <span class="nav-label">Import / Export</span>
        </a>
        <a href="#webdav-sync" class="nav-item" data-section="webdav-sync">
          <span class="nav-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
            </svg>
          </span>
          <span class="nav-label">WebDAV Sync</span>
        </a>
        <a href="#jobs" class="nav-item" data-section="jobs">
          <span class="nav-label">Jobs Dashboard</span>
        </a>
        <a href="#about" class="nav-item" data-section="about">
          <span class="nav-label">About</span>
        </a>
      </nav>
    </aside>

    <main class="middle">
      <div class="settings-content">
        <div id="status" class="status hidden"></div>

        <section id="appearance" class="settings-section">
          <div class="theme-section">
        <h2>Theme</h2>
        <p class="section-description">
          Choose your preferred appearance. Auto will follow your system preferences.
        </p>
        <div class="theme-options">
          <div class="theme-option">
            <input type="radio" id="themeAuto" name="theme" value="auto" checked>
            <label for="themeAuto">
              <div class="theme-preview auto"></div>
              <span class="theme-name">Auto</span>
            </label>
          </div>
          <div class="theme-option">
            <input type="radio" id="themeLight" name="theme" value="light">
            <label for="themeLight">
              <div class="theme-preview light">A</div>
              <span class="theme-name">Light</span>
            </label>
          </div>
          <div class="theme-option">
            <input type="radio" id="themeDark" name="theme" value="dark">
            <label for="themeDark">
              <div class="theme-preview dark">A</div>
              <span class="theme-name">Dark</span>
            </label>
          </div>
          <div class="theme-option">
            <input type="radio" id="themeTerminal" name="theme" value="terminal">
            <label for="themeTerminal">
              <div class="theme-preview terminal">&gt;_</div>
              <span class="theme-name">Terminal</span>
            </label>
          </div>
          <div class="theme-option">
            <input type="radio" id="themeTufte" name="theme" value="tufte">
            <label for="themeTufte">
              <div class="theme-preview tufte">Aa</div>
              <span class="theme-name">Tufte</span>
            </label>
          </div>
        </div>
          </div>
        </section>

        <section id="api-config" class="settings-section">
          <form id="settingsForm">
        <div class="form-group">
          <label for="apiBaseUrl">API Base URL</label>
          <input
            type="url"
            id="apiBaseUrl"
            name="apiBaseUrl"
            placeholder="https://api.openai.com/v1"
            required
          />
          <small class="help-text">
            OpenAI-compatible API endpoint. For OpenAI, use the default.
            For local models, use your local endpoint (e.g., http://localhost:1234/v1)
          </small>
        </div>

        <div class="form-group">
          <label for="apiKey">API Key</label>
          <input
            type="password"
            id="apiKey"
            name="apiKey"
            placeholder="sk-..."
            required
          />
          <small class="help-text">
            Your OpenAI API key or compatible provider key
          </small>
        </div>

        <div class="form-group">
          <label for="chatModel">Chat Model</label>
          <input
            type="text"
            id="chatModel"
            name="chatModel"
            placeholder="gpt-4o-mini"
            required
          />
          <small class="help-text">
            Model for Q&A generation (e.g., gpt-4o-mini, gpt-4o)
          </small>
        </div>

        <div class="form-group">
          <label for="embeddingModel">Embedding Model</label>
          <input
            type="text"
            id="embeddingModel"
            name="embeddingModel"
            placeholder="text-embedding-3-small"
            required
          />
          <small class="help-text">
            Model for generating embeddings (e.g., text-embedding-3-small)
          </small>
        </div>

        <div class="button-group">
          <button type="submit" class="btn btn-primary">
            Save Settings
          </button>
          <button type="button" id="testBtn" class="btn btn-secondary">
            Test Connection
          </button>
        </div>
          </form>
        </section>

        <section id="bulk-import" class="settings-section">
          <div class="data-section">
            <h2>Bulk Import URLs</h2>
        <p class="section-description">
          Import multiple bookmarks at once by pasting a list of URLs (one per line).
        </p>

        <div class="bulk-import-container">
          <textarea
            id="bulkUrlsInput"
            rows="10"
            placeholder="https://example.com/article1&#10;https://example.com/article2&#10;https://github.com/user/repo"
          ></textarea>

          <div id="urlValidationFeedback" class="validation-feedback"></div>

          <div class="button-group">
            <button type="button" id="startBulkImport" class="btn btn-primary" disabled>
              Import URLs
            </button>
            <button type="button" id="cancelBulkImport" class="btn btn-secondary" style="display:none;">
              Cancel
            </button>
          </div>

          <div id="bulkImportProgress" class="bulk-import-progress hidden">
            <div class="progress-bar-container">
              <div id="bulkImportProgressBar" class="progress-bar"></div>
            </div>
            <span id="bulkImportStatus" class="progress-status">Processing...</span>
          </div>
        </div>
          </div>
        </section>

        <section id="import-export" class="settings-section">
          <div class="data-section">
            <h2>Import / Export</h2>
        <p class="section-description">
          Backup your bookmarks or transfer them between browsers.
        </p>

        <div class="data-actions">
          <div class="data-action">
            <h3>Export Bookmarks</h3>
            <p>Download all your bookmarks as a JSON file.</p>
            <button type="button" id="exportBtn" class="btn btn-secondary">
              Export All Bookmarks
            </button>
          </div>

          <div class="data-action">
            <h3>Import Bookmarks</h3>
            <p>Import bookmarks from a previously exported JSON file. Duplicates will be skipped.</p>
            <input type="file" id="importFile" accept=".json" class="file-input" />
            <label for="importFile" class="btn btn-secondary file-label">
              Choose File to Import
            </label>
            <span id="importFileName" class="file-name"></span>
            <button type="button" id="importBtn" class="btn btn-primary" disabled>
              Import
            </button>
          </div>
        </div>

        <div id="importStatus" class="import-status hidden"></div>
          </div>
        </section>

        <!-- WebDAV Sync Section -->
        <section id="webdav-sync" class="settings-section">
          <div class="section-header">
            <h2>WebDAV Sync</h2>
            <p class="section-description">
              Sync your bookmarks across devices using a WebDAV server (Nextcloud, ownCloud, Synology, etc.)
            </p>
          </div>

          <form id="webdavForm">
            <!-- Enable/Disable Toggle -->
            <div class="form-group">
              <label class="toggle-label">
                <input type="checkbox" id="webdavEnabled" name="webdavEnabled" />
                <span class="toggle-text">Enable WebDAV Sync</span>
              </label>
              <small class="help-text">
                When enabled, bookmarks will sync automatically with your WebDAV server
              </small>
            </div>

            <div id="webdavFields" class="conditional-fields">
              <!-- Server URL -->
              <div class="form-group">
                <label for="webdavUrl">Server URL</label>
                <input
                  type="url"
                  id="webdavUrl"
                  name="webdavUrl"
                  placeholder="https://cloud.example.com/remote.php/dav/files/username"
                />
                <small class="help-text">
                  Full WebDAV endpoint URL. For Nextcloud: <code>https://your-server/remote.php/dav/files/USERNAME</code>
                </small>
              </div>

              <!-- Username -->
              <div class="form-group">
                <label for="webdavUsername">Username</label>
                <input
                  type="text"
                  id="webdavUsername"
                  name="webdavUsername"
                  placeholder="your-username"
                  autocomplete="username"
                />
                <small class="help-text">
                  Your WebDAV server username
                </small>
              </div>

              <!-- Password -->
              <div class="form-group">
                <label for="webdavPassword">Password</label>
                <input
                  type="password"
                  id="webdavPassword"
                  name="webdavPassword"
                  placeholder="••••••••"
                  autocomplete="current-password"
                />
                <small class="help-text">
                  Your WebDAV server password or app-specific password. Stored locally only.
                </small>
              </div>

              <!-- Sync Path -->
              <div class="form-group">
                <label for="webdavPath">Sync Folder Path</label>
                <input
                  type="text"
                  id="webdavPath"
                  name="webdavPath"
                  placeholder="/bookmarks"
                />
                <small class="help-text">
                  Folder path on the server where bookmark data will be stored (will be created if it doesn't exist)
                </small>
              </div>

              <!-- Connection Status -->
              <div id="webdavConnectionStatus" class="connection-status hidden">
                <span class="status-indicator"></span>
                <span class="status-text"></span>
              </div>

              <!-- Action Buttons -->
              <div class="button-group">
                <button type="submit" class="btn btn-primary">
                  Save Settings
                </button>
                <button type="button" id="testWebdavBtn" class="btn btn-secondary">
                  Test Connection
                </button>
              </div>
            </div>
          </form>
        </section>

        <section id="jobs" class="settings-section">
          <div class="data-section">
            <h2>Jobs Dashboard</h2>
        <p class="section-description">
          Monitor processing jobs for your bookmarks and bulk imports.
        </p>

        <div class="jobs-controls">
          <div class="jobs-filters">
            <select id="jobTypeFilter" class="filter-select">
              <option value="">All Types</option>
              <option value="manual_add">Manual Add</option>
              <option value="markdown_generation">Markdown Generation</option>
              <option value="qa_generation">Q&A Generation</option>
              <option value="file_import">File Import</option>
              <option value="bulk_url_import">Bulk URL Import</option>
              <option value="url_fetch">URL Fetch</option>
            </select>

            <select id="jobStatusFilter" class="filter-select">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="in_progress">In Progress</option>
              <option value="completed">Completed</option>
              <option value="failed">Failed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>

          <button type="button" id="refreshJobsBtn" class="btn btn-secondary">
            Refresh
          </button>
        </div>

        <div id="jobsList" class="jobs-list">
          <div class="loading">Loading jobs...</div>
        </div>
          </div>
        </section>

        <section id="about" class="settings-section">
          <div class="info-section">
            <h2>About</h2>
        <p>
          Bookmarks by Localforge captures web pages and uses AI to generate searchable
          question-answer pairs, enabling semantic search across your bookmarks.
        </p>
        <p>
          <strong>Privacy:</strong> All bookmarks are stored locally in your browser.
          Only the extracted content is sent to your configured API for processing.
        </p>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script src="options.ts" type="module"></script>
</body>
</html>
